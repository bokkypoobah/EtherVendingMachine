var GAZECOINMETAVERSEASSETADDRESS = "0x2667E5192Bac646A165b7E4f717A7F1c0418CC27";
var GAZECOINMETAVERSEASSETABI =[{"constant":true,"inputs":[{"internalType":"bytes4","name":"interfaceId","type":"bytes4"}],"name":"supportsInterface","outputs":[{"internalType":"bool","name":"","type":"bool"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":true,"inputs":[],"name":"name","outputs":[{"internalType":"string","name":"","type":"string"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":true,"inputs":[{"internalType":"uint256","name":"tokenId","type":"uint256"}],"name":"getApproved","outputs":[{"internalType":"address","name":"","type":"address"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":false,"inputs":[{"internalType":"address","name":"to","type":"address"},{"internalType":"uint256","name":"tokenId","type":"uint256"}],"name":"approve","outputs":[],"payable":false,"stateMutability":"nonpayable","type":"function"},{"constant":false,"inputs":[{"internalType":"uint256","name":"tokenId","type":"uint256"},{"internalType":"string","name":"uri","type":"string"}],"name":"setTokenURI","outputs":[],"payable":false,"stateMutability":"nonpayable","type":"function"},{"constant":true,"inputs":[],"name":"totalSupply","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":false,"inputs":[{"internalType":"uint256","name":"tokenId","type":"uint256"},{"internalType":"string","name":"key","type":"string"}],"name":"removeAttribute","outputs":[],"payable":false,"stateMutability":"nonpayable","type":"function"},{"constant":true,"inputs":[{"internalType":"uint256","name":"tokenId","type":"uint256"}],"name":"numberOfAttributes","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":false,"inputs":[{"internalType":"address","name":"from","type":"address"},{"internalType":"address","name":"to","type":"address"},{"internalType":"uint256","name":"tokenId","type":"uint256"}],"name":"transferFrom","outputs":[],"payable":false,"stateMutability":"nonpayable","type":"function"},{"constant":true,"inputs":[{"internalType":"uint256","name":"tokenId","type":"uint256"},{"internalType":"uint256","name":"_index","type":"uint256"}],"name":"getAttributeByIndex","outputs":[{"internalType":"bool","name":"_exists","type":"bool"},{"internalType":"string","name":"_key","type":"string"},{"internalType":"string","name":"_value","type":"string"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":false,"inputs":[{"internalType":"uint256","name":"tokenId","type":"uint256"},{"internalType":"string","name":"key","type":"string"},{"internalType":"string","name":"value","type":"string"}],"name":"addAttribute","outputs":[],"payable":false,"stateMutability":"nonpayable","type":"function"},{"constant":true,"inputs":[{"internalType":"address","name":"owner","type":"address"},{"internalType":"uint256","name":"index","type":"uint256"}],"name":"tokenOfOwnerByIndex","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":false,"inputs":[{"internalType":"address","name":"from","type":"address"},{"internalType":"address","name":"to","type":"address"},{"internalType":"uint256","name":"tokenId","type":"uint256"}],"name":"safeTransferFrom","outputs":[],"payable":false,"stateMutability":"nonpayable","type":"function"},{"constant":false,"inputs":[{"internalType":"uint256","name":"tokenId","type":"uint256"}],"name":"burn","outputs":[],"payable":false,"stateMutability":"nonpayable","type":"function"},{"constant":false,"inputs":[{"internalType":"address","name":"to","type":"address"},{"internalType":"string","name":"tokenURI","type":"string"}],"name":"mintWithTokenURI","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"payable":false,"stateMutability":"nonpayable","type":"function"},{"constant":true,"inputs":[{"internalType":"uint256","name":"index","type":"uint256"}],"name":"tokenByIndex","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":false,"inputs":[{"internalType":"string","name":"uri","type":"string"}],"name":"setBaseURI","outputs":[],"payable":false,"stateMutability":"nonpayable","type":"function"},{"constant":true,"inputs":[{"internalType":"uint256","name":"tokenId","type":"uint256"}],"name":"ownerOf","outputs":[{"internalType":"address","name":"","type":"address"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":false,"inputs":[{"internalType":"address","name":"to","type":"address"}],"name":"mint","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"payable":false,"stateMutability":"nonpayable","type":"function"},{"constant":true,"inputs":[],"name":"baseURI","outputs":[{"internalType":"string","name":"","type":"string"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":true,"inputs":[{"internalType":"address","name":"owner","type":"address"}],"name":"balanceOf","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":false,"inputs":[],"name":"acceptOwnership","outputs":[],"payable":false,"stateMutability":"nonpayable","type":"function"},{"constant":false,"inputs":[{"internalType":"address","name":"_newOwner","type":"address"}],"name":"transferOwnershipImmediately","outputs":[],"payable":false,"stateMutability":"nonpayable","type":"function"},{"constant":true,"inputs":[],"name":"owner","outputs":[{"internalType":"address","name":"","type":"address"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":true,"inputs":[],"name":"symbol","outputs":[{"internalType":"string","name":"","type":"string"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":false,"inputs":[{"internalType":"address","name":"to","type":"address"},{"internalType":"bool","name":"approved","type":"bool"}],"name":"setApprovalForAll","outputs":[],"payable":false,"stateMutability":"nonpayable","type":"function"},{"constant":false,"inputs":[{"internalType":"address","name":"from","type":"address"},{"internalType":"address","name":"to","type":"address"},{"internalType":"uint256","name":"tokenId","type":"uint256"},{"internalType":"bytes","name":"_data","type":"bytes"}],"name":"safeTransferFrom","outputs":[],"payable":false,"stateMutability":"nonpayable","type":"function"},{"constant":true,"inputs":[{"internalType":"uint256","name":"tokenId","type":"uint256"}],"name":"tokenURI","outputs":[{"internalType":"string","name":"","type":"string"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":true,"inputs":[],"name":"newOwner","outputs":[{"internalType":"address","name":"","type":"address"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":true,"inputs":[{"internalType":"address","name":"owner","type":"address"},{"internalType":"address","name":"operator","type":"address"}],"name":"isApprovedForAll","outputs":[{"internalType":"bool","name":"","type":"bool"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":false,"inputs":[{"internalType":"uint256","name":"tokenId","type":"uint256"},{"internalType":"string","name":"key","type":"string"},{"internalType":"string","name":"value","type":"string"}],"name":"updateAttribute","outputs":[],"payable":false,"stateMutability":"nonpayable","type":"function"},{"constant":false,"inputs":[{"internalType":"address","name":"_newOwner","type":"address"}],"name":"transferOwnership","outputs":[],"payable":false,"stateMutability":"nonpayable","type":"function"},{"inputs":[],"payable":false,"stateMutability":"nonpayable","type":"constructor"},{"anonymous":false,"inputs":[{"indexed":true,"internalType":"uint256","name":"tokenId","type":"uint256"},{"indexed":false,"internalType":"string","name":"key","type":"string"},{"indexed":false,"internalType":"string","name":"value","type":"string"},{"indexed":false,"internalType":"uint256","name":"totalAfter","type":"uint256"}],"name":"AttributeAdded","type":"event"},{"anonymous":false,"inputs":[{"indexed":true,"internalType":"uint256","name":"tokenId","type":"uint256"},{"indexed":false,"internalType":"string","name":"key","type":"string"},{"indexed":false,"internalType":"uint256","name":"totalAfter","type":"uint256"}],"name":"AttributeRemoved","type":"event"},{"anonymous":false,"inputs":[{"indexed":true,"internalType":"uint256","name":"tokenId","type":"uint256"},{"indexed":false,"internalType":"string","name":"key","type":"string"},{"indexed":false,"internalType":"string","name":"value","type":"string"}],"name":"AttributeUpdated","type":"event"},{"anonymous":false,"inputs":[{"indexed":true,"internalType":"address","name":"_from","type":"address"},{"indexed":true,"internalType":"address","name":"_to","type":"address"}],"name":"OwnershipTransferred","type":"event"},{"anonymous":false,"inputs":[{"indexed":true,"internalType":"address","name":"from","type":"address"},{"indexed":true,"internalType":"address","name":"to","type":"address"},{"indexed":true,"internalType":"uint256","name":"tokenId","type":"uint256"}],"name":"Transfer","type":"event"},{"anonymous":false,"inputs":[{"indexed":true,"internalType":"address","name":"owner","type":"address"},{"indexed":true,"internalType":"address","name":"approved","type":"address"},{"indexed":true,"internalType":"uint256","name":"tokenId","type":"uint256"}],"name":"Approval","type":"event"},{"anonymous":false,"inputs":[{"indexed":true,"internalType":"address","name":"owner","type":"address"},{"indexed":true,"internalType":"address","name":"operator","type":"address"},{"indexed":false,"internalType":"bool","name":"approved","type":"bool"}],"name":"ApprovalForAll","type":"event"}];

const GazeCoinBuilder = {
  template: `
  <div>
    <div>
      <b-row>
        <b-col cols="12" md="8">
          <b-card title="GazeCoin Builder" \>
            <b-form @submit="onSubmit" v-if="show">

              <div>
                <b-button v-b-toggle.collapse-1 variant="primary">Display</b-button>
                <b-collapse visible id="collapse-1" class="mt-2">
                  <b-card>
                    <b-form-group label="Display as: " label-cols="4">
                      <b-form-radio-group id="displayMode" v-model="displayMode" name="displayModeComponent">
                        <b-form-radio value="list" v-b-popover.hover.top="'Display as list'">List</b-form-radio>
                        <b-form-radio value="cards" v-b-popover.hover.top="'Display are cards'">Cards</b-form-radio>
                      </b-form-radio-group>
                    </b-form-group>
                    <b-form-group label="Page size: " label-cols="4">
                      <b-input-group prepend="10" append="100" class="mt-3">
                        <b-form-input :value.trim="displayPageSize" @input="updateDisplayPageSize" type="range" min="10" max="100" step="5"></b-form-input>
                      </b-input-group>
                    </b-form-group>
                    <b-pagination :value.trim="displayPage" @input="updateDisplayPage" :total-rows="displayTotalRows" :per-page="displayPageSize" aria-controls="my-table" ></b-pagination>
                  </b-card>
                </b-collapse>
              </div>

              <b-card-group deck v-if="displayMode != 'list'" v-for="(item, key, index) in items" v-bind:key="item.number">
                <b-card no-body img-top style="max-width: 20rem;">
                  <b-card-header>
                    <b-card-title>
                      <b-link :to="'/gazeCoinBuilder/' + item.tokenId">#{{ item.number }} TokenId {{ item.tokenId }}</b-link>
                    </b-card-title>
                  </b-card-header>
                  <b-card-body>
                    <b-card-img class="mb-3" src="https://placekitten.com/300/300">
                    </b-card-img>
                    <b-card-text class="truncate">
                      <b-link :to="'/gazeCoinBuilder/' + item.owner">Owner {{ item.owner }}</b-link>
                    </b-card-text>
                    <b-table striped selectable selected-variant="success" hover :items="item.attributes"></b-table>
                  </b-card-body>
                  <b-button href="#" variant="primary">Go somewhere</b-button>
                </b-card>
              </b-card-group>

              <b-table v-if="displayMode == 'list'" striped selectable selected-variant="success" hover :items="items" :fields="fields"></b-table>

            </b-form>
          </b-card>
        </b-col>
        <b-col cols="12" md="4">
          <connection></connection>
          <br />
          <b-card v-if="show" title="GazeCoin Metaverse Assets">
            <b-row>
              <b-col cols="4">NFT Contract</b-col><b-col class="truncate" cols="8"><b-link :href="explorer + 'token/' + nftAddress" class="card-link" target="_blank">{{ nftAddress }}</b-link></b-col>
            </b-row>
            <b-row>
              <b-col cols="4">Symbol</b-col><b-col class="truncate" cols="8">{{ symbol }}</b-link></b-col>
            </b-row>
            <b-row>
              <b-col cols="4">Name</b-col><b-col class="truncate" cols="8">{{ name }}</b-link></b-col>
            </b-row>
            <b-row>
              <b-col cols="4">Your assets</b-col><b-col class="truncate" cols="8"><b-link :href="explorer + 'token/' + nftAddress + '?a=' + coinbase" class="card-link" target="_blank">{{ balanceOf }}</b-link></b-col>
            </b-row>
            <b-row>
              <b-col cols="4">All assets</b-col><b-col class="truncate" cols="8"><b-link :href="explorer + 'token/' + nftAddress" class="card-link" target="_blank">{{ totalSupply }}</b-link></b-col>
            </b-row>
            <!--
            <div>Latest deployed token contracts (max {{ factoryDisplayMaxChildren + ' of ' + factoryNumberOfChildren }})</div>
            <b-row no-gutters v-for="(child) in factoryChildren">
              <b-col cols="1">{{ child.number }}</b-col>
              <b-col class="truncate">
                <b-link :href="explorer + 'token/' + child.address" class="card-link" target="_blank">{{ child.symbol + ':' + child.name + ':' + child.decimals + ':' + child.totalSupplyString + ':' + child.address.substring(0, 10) }}</b-link>
              </b-col>
            </b-row>
            -->
          </b-card>
        </b-col>
      </b-row>
    </div>
  </div>
  `,
  data: function () {
    return {
      show: true,
      isBusy: true,
      // pages: "10",
      displayMode: "cards", // "list" or "cards"
      fields: [
        { key: 'number', label: '#', stickyColumn: true, variant: 'primary' },
        { key: 'tokenId', label: 'TokenId', stickyColumn: true, isRowHeader: true, variant: 'info' },
        { key: 'owner', label: 'Owner', stickyColumn: true, variant: 'info' },
        { key: 'attributes', label: 'Attributes', variant: 'info' },
      ],
    }
  },
  computed: {
    symbol() {
      return store.getters['gazeCoinBuilder/symbol'];
    },
    name() {
      return store.getters['gazeCoinBuilder/name'];
    },
    explorer () {
      return store.getters['connection/explorer'];
    },
    nftAddress() {
      return store.getters['gazeCoinBuilder/nftAddress'];
    },
    totalSupply() {
      return store.getters['gazeCoinBuilder/totalSupply'];
    },
    balanceOf() {
      return store.getters['gazeCoinBuilder/balanceOf'];
    },
    displayPageSize() {
      return store.getters['gazeCoinBuilder/displayPageSize'];
    },
    displayPage() {
      return store.getters['gazeCoinBuilder/displayPage'];
    },
    displayTotalRows() {
      if (store.getters['gazeCoinBuilder/params'] == "owned") {
        return parseInt(store.getters['gazeCoinBuilder/balanceOf']);
      } else {
        return parseInt(store.getters['gazeCoinBuilder/totalSupply']);
      }
    },
    pages() {
      return store.getters['gazeCoinBuilder/pages'];
    },
    items() {
      return store.getters['gazeCoinBuilder/items'];
    },
    coinbase() {
      return store.getters['connection/coinbase'];
    },
  },
  methods: {
    updateDisplayPageSize (e) {
      this.$store.commit('gazeCoinBuilder/updateDisplayPageSize', e);
    },
    updateDisplayPage (e) {
      this.$store.commit('gazeCoinBuilder/updateDisplayPage', e);
    },
    onSubmit(event) {
      event.preventDefault();
      this.$store.commit('gazeCoinBuilder/updateActionDeploy', true);
    },
  },
  mounted() {
  },
};

const gazeCoinBuilderModule = {
  namespaced: true,
  state: {
    nftAddress: GAZECOINMETAVERSEASSETADDRESS,
    symbol: "DEFAULTSYMBOL",
    name: "DEFAULTNAME",
    totalSupply: "0",
    balanceOf: "0",
    params: null,
    displayPageSize: "5",
    displayPage: "1",
    items: [],
    executing: false,
    refreshRequested: false,
  },
  getters: {
    nftAddress: state => state.nftAddress,
    symbol: state => state.symbol,
    name: state => state.name,
    totalSupply: state => state.totalSupply,
    balanceOf: state => state.balanceOf,
    params: state => state.params,
    displayPageSize: state => state.displayPageSize,
    displayPage: state => state.displayPage,
    items: state => state.items,
    refreshRequested: state => state.refreshRequested,
  },
  computed: {
    pages() {
      if (state.params == "owned") {
        var pages = Math.round(((state.balanceOf - 1) / state.displayPageSize), 0) + 1
        return pages.toString();
      } else {
        var pages = Math.round(((state.totalSupply - 1) / state.displayPageSize), 0) + 1
        return pages.toString();
      }
    },
  },
  mutations: {
    updateSymbol (state, symbol) {
      state.symbol = symbol;
      logIt("gazeCoinBuilderModule", "updateSymbol('" + symbol + "')")
    },
    updateName (state, name) {
      state.name = name;
      logIt("gazeCoinBuilderModule", "updateName('" + name + "')")
    },
    updateTotalSupply (state, totalSupply) {
      state.totalSupply = totalSupply;
      logIt("gazeCoinBuilderModule", "updateTotalSupply('" + totalSupply + "')")
    },
    updateBalanceOf (state, balanceOf) {
      state.balanceOf = balanceOf;
      logIt("gazeCoinBuilderModule", "updateBalanceOf('" + balanceOf + "')")
    },
    updateParams (state, params) {
      state.params = params;
      logIt("gazeCoinBuilderModule", "updateParams('" + params + "')")
    },
    updateDisplayPageSize (state, displayPageSize) {
      state.displayPageSize = displayPageSize;
      state.refreshRequested = true;
      logIt("gazeCoinBuilderModule", "updateDisplayPageSize('" + displayPageSize + "'). refreshRequested true")
    },
    updateDisplayPage (state, displayPage) {
      state.displayPage = displayPage;
      state.refreshRequested = true;
      logIt("gazeCoinBuilderModule", "updateDisplayPage('" + displayPage + "'). refreshRequested true")
    },
    updateItems (state, items) {
      Vue.set(state, 'items', items);
      logIt("gazeCoinBuilderModule", "updateItems('" + Object.keys(items).length + "' items)");
    },
    updateExecuting (state, executing) {
      state.executing = executing;
      logIt("gazeCoinBuilderModule", "updateExecuting('" + executing + "')")
    },
    updateRefreshRequested (state, refreshRequested) {
      state.refreshRequested = refreshRequested;
      logIt("gazeCoinBuilderModule", "updateRefreshRequested('" + refreshRequested + "')")
    },
  },
  actions: {

    // all
    // owned
    // 0x123456
    // new
    // {tokenId}
    // TODO {tokenIndexFrom-tokenIndexTo}

    async execWeb3 ({state, commit, rootState}, {count, networkChanged, blockChanged, coinbaseChanged}) {
      if (!state.executing) {
        commit('updateExecuting', true);
        logIt("gazeCoinBuilderModule", "execWeb3() start[" + count + ", " + JSON.stringify(rootState.route.params) + ", " + networkChanged + ", " + blockChanged + ", " + coinbaseChanged + ", " + state.refreshRequested + "]");

        var paramsChanged = false;
        if (state.params != rootState.route.params.param) {
          logIt("gazeCoinBuilderModule", "execWeb3() params changed from " + state.params + " to " + JSON.stringify(rootState.route.params.param));
          paramsChanged = true;
          commit('updateParams', rootState.route.params.param);
        }

        var contract = web3.eth.contract(GAZECOINMETAVERSEASSETABI).at(state.nftAddress);
        if (networkChanged || blockChanged || coinbaseChanged || paramsChanged || state.refreshRequested) {
          var _symbol = promisify(cb => contract.symbol(cb));
          var symbol = await _symbol;
          if (symbol !== state.symbol) {
            commit('updateSymbol', symbol);
          }
          var _name = promisify(cb => contract.name(cb));
          var name = await _name;
          if (name !== state.name) {
            commit('updateName', name);
          }
          var _totalSupply = promisify(cb => contract.totalSupply(cb));
          var totalSupply = await _totalSupply;
          if (!totalSupply.equals(state.totalSupply)) {
            commit('updateTotalSupply', totalSupply);
          }
          var coinbase = store.getters['connection/coinbase'];
          var _balanceOf = promisify(cb => contract.balanceOf(coinbase, cb));
          var balanceOf = await _balanceOf;
          if (!balanceOf.equals(state.balanceOf)) {
            commit('updateBalanceOf', balanceOf);
          }
          var i;
          var numbers = [];
          var tokenIds = {};
          var items = [];

          var paramIsAccount = state.params.toLowerCase().substring(0, 2) == "0x";
          var numberRangePattern = new RegExp("^[0-9]*-[0-9]*$");
          var paramIsNumberRange = numberRangePattern.test(state.params);
          var numberPattern = new RegExp("^[0-9]*$");
          var paramIsNumber = numberPattern.test(state.params);
          logIt("gazeCoinBuilderModule", "execWeb3() paramIsNumberRange: " + paramIsNumberRange);
          logIt("gazeCoinBuilderModule", "execWeb3() paramIsNumber: " + paramIsNumber);

          // Owned or specified accounts
          if (state.params == "owned" || paramIsAccount) {
            var account = paramIsAccount ? state.params : coinbase;
            var accountBalanceOf = balanceOf;
            if (paramIsAccount) {
              var _accountBalanceOf = promisify(cb => contract.balanceOf(state.params, cb));
              var accountBalanceOf = await _accountBalanceOf;
            }

            var pages = Math.round(((accountBalanceOf - 1) / state.displayPageSize), 0) + 1
            var page = Math.min(Math.max(state.displayPage, 0), pages);
            var start = Math.max((page - 1) * state.displayPageSize, 0);
            var end = Math.min(page * state.displayPageSize, accountBalanceOf);
            logIt("gazeCoinBuilderModule", "execWeb3() " + account + " pages " + pages + " page " + page + " start " + start + " end " + end);
            for (i = start; i < end; i++) {
              var tokenId;
              try {
                var _tokenId = promisify(cb => contract.tokenOfOwnerByIndex(account, i, cb));
                tokenId = await _tokenId;
                // TODO: Account for deleted tokenIds
                if (tokenId > 0 && tokenId < totalSupply) {
                  numbers.push(i + 1);
                  tokenIds[i + 1] = { tokenId: tokenId, owner: coinbase };
                  logIt("gazeCoinBuilderModule", "execWeb3() owned token " + i + " with tokenId:" + tokenId);
                }
              } catch (error) {
                logIt("gazeCoinBuilderModule", "execWeb3() tokenOfOwnerByIndex error " + error);
              }
            }
          // All
          } else if (state.params == "all") {
            var pages = Math.round(((totalSupply - 1) / state.displayPageSize), 0) + 1
            var page = Math.min(Math.max(state.displayPage, 0), pages);
            var start = Math.max((page - 1) * state.displayPageSize, 0);
            var end = Math.min(page * state.displayPageSize, totalSupply);
            logIt("gazeCoinBuilderModule", "execWeb3() all pages " + pages + " page " + page + " start " + start + " end " + end);
            for (i = start; i < end; i++) {
              var _tokenId = promisify(cb => contract.tokenByIndex(i, cb));
              var tokenId = await _tokenId;
              var _ownerOf = promisify(cb => contract.ownerOf(tokenId, cb));
              var ownerOf = await _ownerOf;
              numbers.push(i + 1);
              tokenIds[i + 1] = { tokenId: tokenId, owner: ownerOf };
              logIt("gazeCoinBuilderModule", "execWeb3() all token " + i + " with tokenId:" + tokenId);
            }

          // Specific tokenId
          } else if (paramIsNumber) {
            var tokenId = parseInt(state.params);
            logIt("gazeCoinBuilderModule", "execWeb3() tokenId " + tokenId);
            var ownerOf;
            i = 0;
            try {
              var _ownerOf = promisify(cb => contract.ownerOf(tokenId, cb));
              ownerOf = await _ownerOf;
              if (ownerOf != "0x0000000000000000000000000000000000000000") {
                numbers.push(i + 1);
                tokenIds[i + 1] = { tokenId: tokenId, owner: ownerOf };
                logIt("gazeCoinBuilderModule", "execWeb3() all token " + i + " with tokenId:" + tokenId);
              }
            } catch (error) {
              logIt("gazeCoinBuilderModule", "execWeb3() ownerOf error " + error);
            }

          // TODO - not working
          // Token index 0 to n-1
          } else if (paramIsNumberRange) {
            var numberRangeExtractorPattern = new RegExp("^([0-9])*-([0-9]*)$");
            var numberRange = state.params.match(numberRangeExtractorPattern);
            logIt("gazeCoinBuilderModule", "execWeb3() range " + numberRange[1] + " to " + numberRange[2]);
            var pages = Math.round(((totalSupply - 1) / state.displayPageSize), 0) + 1
            var page = Math.min(Math.max(state.displayPage, 0), pages);
            var start = Math.max((page - 1) * state.displayPageSize, 0);
            var end = Math.min(page * state.displayPageSize, totalSupply);
            logIt("gazeCoinBuilderModule", "execWeb3() all pages " + pages + " page " + page + " start " + start + " end " + end);
            for (i = start; i < end; i++) {
              var _tokenId = promisify(cb => contract.tokenByIndex(i, cb));
              var tokenId = await _tokenId;
              var _ownerOf = promisify(cb => contract.ownerOf(tokenId, cb));
              var ownerOf = await _ownerOf;
              numbers.push(i + 1);
              tokenIds[i + 1] = { tokenId: tokenId, owner: ownerOf };
              logIt("gazeCoinBuilderModule", "execWeb3() all token " + i + " with tokenId:" + tokenId);
            }
          }
          // Object.keys(tokenIds).forEach(function(number) {
          //   var tokenId = tokenIds[number];
          //   console.log(number + " => " + tokenIds[number]);
          // });
          for (i = 0; i < numbers.length; i++) {
            var number = numbers[i];
            var tokenId = tokenIds[number].tokenId;
            var owner = tokenIds[number].owner;
            var _numberOfAttributes = promisify(cb => contract.numberOfAttributes(tokenId, cb));
            var numberOfAttributes = await _numberOfAttributes;
            logIt("gazeCoinBuilderModule", "execWeb3() token " + i + " has tokenId #" + tokenId + " with " + numberOfAttributes + " attributes");
            var attributes = [];
            var j;
            for (j = 0; j < numberOfAttributes; j++) {
              var _attribute = promisify(cb => contract.getAttributeByIndex(tokenId, j, cb));
              var attribute = await _attribute;
              logIt("gazeCoinBuilderModule", "execWeb3()   attribute " + j + " " + JSON.stringify(attribute));
              attributes.push({ key: attribute[1], value: attribute[2] });
            }
            items.push({ number: number, tokenId: tokenId, owner: owner, attributes: attributes });
          }
          commit('updateItems', items);
        }
        if (state.refreshRequested) {
          commit('updateRefreshRequested', false);
        }
        commit('updateExecuting', false);
        logIt("gazeCoinBuilderModule", "execWeb3() items " + JSON.stringify(items));
        logIt("gazeCoinBuilderModule", "execWeb3() end[" + count + ", " + networkChanged + ", " + blockChanged + ", " + coinbaseChanged + "]");
      } else {
        logIt("gazeCoinBuilderModule", "execWeb3() already executing[" + count + ", " + networkChanged + ", " + blockChanged + ", " + coinbaseChanged + "]");
      }
    }
  },
};
